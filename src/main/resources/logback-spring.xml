<?xml version="1.0" encoding="UTF-8"?>
<configuration>
	<include resource="org/springframework/boot/logging/logback/defaults.xml" />
	<springProperty scope="context" name="springAppName"
		source="spring.application.name" />
	<springProperty scope="context" name="springActiveProfile"
		source="spring.profiles.active" />
	<property name="LOG_FILE" value="${BUILD_FOLDER:-build}/${springAppName}" />
	​
	<springProperty scope="context" name="logstash_hostname"
		source="logstash.tcpConfig.hostname" />

	<springProperty scope="context" name="logstash_port"
		source="logstash.tcpConfig.port" />

	<springProperty scope="context" name="rabbitmq_exchange"
       source="omwauditlogging.rabbitMq.exchangeName" />         
    <springProperty scope="context" name="rabbitmq_instance_id"
      source="omwauditlogging.rabbitMq.serviceInstanceId" />

	<appender name="console" class="ch.qos.logback.core.ConsoleAppender">
		<encoder class="net.logstash.logback.encoder.LogstashEncoder">
			 <!-- <jsonGeneratorDecorator
				class="net.logstash.logback.decorate.PrettyPrintingJsonGeneratorDecorator" />  -->
			<fieldNames>
				<message>log_message</message>
			</fieldNames>
		</encoder>
	</appender>

	<appender name="stash"
		class="net.logstash.logback.appender.LogstashTcpSocketAppender">
		<remoteHost>${logstash_hostname}</remoteHost>
		<port>${logstash_port}</port>
		<encoder class="net.logstash.logback.encoder.LogstashEncoder">
			<fieldNames>
				<message>log_message</message>
			</fieldNames>
		</encoder>
	</appender>
	
	<springProperty scope="context" name="rabbitmq_exchange"
       source="omwauditlogging.rabbitMq.exchangeName" />        
	<springProperty scope="context" name="rabbitmq_instance_id"
      source="omwauditlogging.rabbitMq.serviceInstanceId" />
      
	<appender name="auditlog"
      class="com.comcast.orion.logging.appender.AuditLogAppender">
  	<layout>
    <pattern>%d{yyyyMMdd'T'HHmmss} %thread %level %logger{15} %msg%n</pattern>
  	</layout>
  	<exchange>${rabbitmq_exchange}</exchange>  
  	<auditLogEnabled>true</auditLogEnabled>
  	<serviceInstanceId>${rabbitmq_instance_id}</serviceInstanceId> 
 	<profile>${springActiveProfile}</profile>
	</appender>

	<appender name="async" class="ch.qos.logback.classic.AsyncAppender">
		<appender-ref ref="auditlog" />
	</appender>

	<logger name="com.comcast.orion.logging.messaging" level="INFO"
		additivity="false">
		<appender-ref ref="async" />
	</logger>

	<logger name="com.comcast.orion.logging" level="INFO"
		additivity="false">
		<appender-ref ref="console" />
		<appender-ref ref="stash" />
	</logger>

	<logger name="com.comcast.orion.workorder" level="INFO"
		additivity="false">
		<appender-ref ref="console" />
		<appender-ref ref="stash" />
	</logger>
	​
	<root level="INFO">
		<appender-ref ref="console" />
		<appender-ref ref="stash" />
	</root>
</configuration>
